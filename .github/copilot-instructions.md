# GitHub Copilot 指令

本文件为 GitHub Copilot 提供仓库级别的指令和约定。

## 项目概述

agenty 是一个用 Go 编写的 AI 代理应用，包含后端服务和 CLI 应用程序，支持工具调用、代理循环和技能使用。后端服务也可作为 MCP 客户端与其他 MCP 服务器通信以扩展其能力。

## 技术栈

- **语言**: Go 1.25
- **Web 框架**: Gin (v1.11.0)
- **数据库**: PostgreSQL with GORM (v1.31.1)
- **配置管理**: Viper (v1.21.0)
- **LLM 集成**: OpenAI SDK (v3.17.0), 自定义 HTTP 客户端用于 Anthropic/Kimi/Gemini
- **实用工具**: samber/lo (v1.52.0), google/uuid (v1.6.0)

## 编码规范

### Go 代码风格

- 遵循 Go 官方编码标准和最佳实践
- 使用标准的 Go 命名约定（驼峰命名法）
- **除非明确要求，否则不要编写注释**
- 使用常量、配置文件或环境变量，避免硬编码值
- 确保代码抽象、模块化和封装，以促进可重用性和可维护性
- 始终进行适当的错误处理
- 在检查边缘情况时考虑性能优化

### 架构模式

- 使用 `sync.Once` 实现服务、路由和执行器的单例模式
- 使用 GORM G[] 泛型助手进行数据库查询
- 使用 Gin 框架处理 HTTP 请求
- 聊天功能使用 ChatProvider 接口，支持多个实现（OpenAI SDK、Anthropic/Kimi/Gemini HTTP）
- 工具定义在 `pkg/chat/tools/` 目录中

### 项目结构

- `cmd/` - 应用程序的 main.go
- `pkg/` - 跨项目使用的核心代码和库
  - `config/` - 配置管理
  - `conn/` - 连接和客户端
  - `customerrors/` - 自定义错误定义
  - `middleware/` - GIN 框架的中间件
  - `models/` - 数据模型和结构
  - `routes/` - API 路由
  - `services/` - 业务逻辑和服务
  - `utils/` - 实用函数和帮助器
  - `chat/` - LLM 聊天逻辑和工具调用函数
- `.agents/skills/` - 包含对代理工作至关重要的技能

## 构建和测试

- **构建**: `go build ./...`
- **代码检查**: `go vet ./...`
- **测试**: `go test ./... -v`
- **格式化**: `go fmt ./...`

## 重要约定

1. **理解项目结构**: 在进行任何更改之前，先熟悉项目结构
2. **抽象和模块化**: 确保代码抽象、模块化和封装
3. **审查一切**: 在完成之前审查代码，检查边缘情况、错误处理和性能
4. **搜索最新信息**: 在添加新功能或依赖时，搜索互联网以获取最新信息
5. **使用技能**: 必要时使用 `.agents/skills` 中的技能
6. **先思考后行动**: 在执行任何操作之前制定完整计划

## 安全实践

- 永远不要将敏感信息（密钥、令牌、密码）硬编码到源代码中
- 使用环境变量或安全配置管理敏感数据
- 始终验证和清理用户输入
- 遵循 OWASP 安全最佳实践

## 禁止操作

- 不要修改工作代码，除非绝对必要或修复与更改相关的安全漏洞
- 不要删除或修改现有测试，除非它们与您的更改直接相关
- 不要引入新的安全漏洞
- 除非明确要求，否则不要添加注释

## 与其他 AI 代理的兼容性

本项目还包含 `AGENTS.md` 文件，为多个 AI 编码代理（如 Claude Code、GitHub Copilot 和 Trae）提供指导。请确保您的更改与该文件中的指令保持一致。
